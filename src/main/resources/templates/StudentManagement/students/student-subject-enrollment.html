<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title th:text="'Student Subject Enrollment'">Student Subject Enrollment</title>-->
<!--</head>-->
<!--<body>-->

<!--&lt;!&ndash; Replace the content section &ndash;&gt;-->
<!--<div th:replace="layout/base.html">-->
<!--    <div th:fragment="content">-->
<!--        <main>-->

<!--            <h1>Student Subject Enrollment</h1>-->

<!--            &lt;!&ndash; Dropdowns for Selection &ndash;&gt;-->
<!--            <form id="enrollmentForm">-->
<!--                <label for="department">Select Department:</label>-->
<!--                <select name="departmentId" id="department" required>-->
<!--                    <option value="">&#45;&#45;Select Department&#45;&#45;</option>-->
<!--                    <th:block th:each="department : ${departments}">-->
<!--                        <option th:value="${department.id}" th:text="${department.name}"></option>-->
<!--                    </th:block>-->
<!--                </select>-->

<!--                <label for="course">Select Course:</label>-->
<!--                <select name="courseId" id="course" required>-->
<!--                    <option value="">&#45;&#45;Select Course&#45;&#45;</option>-->
<!--                </select>-->

<!--                <label for="semester">Select Semester:</label>-->
<!--                <select name="semesterId" id="semester" required>-->
<!--                    <option value="">&#45;&#45;Select Semester&#45;&#45;</option>-->
<!--                </select>-->

<!--                <label for="subject">Select Subject:</label>-->
<!--                <select name="subjectId" id="subject" required>-->
<!--                    <option value="">&#45;&#45;Select Subject&#45;&#45;</option>-->
<!--                </select>-->

<!--                <label for="division">Select Division:</label>-->
<!--                <select name="divisionId" id="division" required>-->
<!--                    <option value="">&#45;&#45;Select Division&#45;&#45;</option>-->
<!--                </select>-->
<!--            </form>-->

<!--            &lt;!&ndash; Student List &ndash;&gt;-->
<!--            <h2>Select Students</h2>-->
<!--            <table id="studentTable">-->
<!--                <thead>-->
<!--                <tr>-->
<!--                    <th>Select</th>-->
<!--                    <th>ID</th>-->
<!--                    <th>First Name</th>-->
<!--                    <th>Last Name</th>-->
<!--                    <th>Email</th>-->
<!--                </tr>-->
<!--                </thead>-->
<!--                <tbody>-->
<!--                </tbody>-->
<!--            </table>-->

<!--            &lt;!&ndash; Submit Button &ndash;&gt;-->
<!--            <button id="assignSubjects" disabled>Assign Subject to Selected Students</button>-->

<!--            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>-->
<!--            <script>-->
<!--                $(document).ready(function () {-->
<!--                    // Fetch courses when a department is selected-->
<!--                    $('#department').change(function () {-->
<!--                        var departmentId = $(this).val();-->
<!--                        console.log(departmentId)-->
<!--                        if (departmentId) {-->
<!--                            $.get("/admin/students/courses/" + departmentId, function (courses) {-->
<!--                                $('#course').empty().append('<option value="">&#45;&#45;Select Course&#45;&#45;</option>');-->
<!--                                $.each(courses, function (index, course) {-->
<!--                                    $('#course').append('<option value="' + course.courseID + '">' + course.courseName + '</option>');-->
<!--                                });-->
<!--                            });-->
<!--                        } else {-->
<!--                            $('#course, #semester, #subject, #division').empty().append('<option value="">&#45;&#45;Select&#45;&#45;</option>');-->
<!--                            $('#studentTable tbody').empty();-->
<!--                        }-->
<!--                    });-->

<!--                    // Fetch semesters when a course is selected-->
<!--                    $('#course').change(function () {-->
<!--                        var courseId = $(this).val();-->
<!--                        if (courseId) {-->
<!--                            $.get("/admin/students/semesters/" + courseId, function (semesters) {-->
<!--                                $('#semester').empty().append('<option value="">&#45;&#45;Select Semester&#45;&#45;</option>');-->
<!--                                $.each(semesters, function (index, semester) {-->
<!--                                    $('#semester').append('<option value="' + semester.id + '">' + semester.name + " - " + semester.academicYear + '</option>');-->
<!--                                });-->
<!--                            });-->
<!--                        } else {-->
<!--                            $('#semester, #subject, #division').empty().append('<option value="">&#45;&#45;Select&#45;&#45;</option>');-->
<!--                            $('#studentTable tbody').empty();-->
<!--                        }-->
<!--                    });-->

<!--                    // Fetch subjects when a semester is selected-->
<!--                    $('#semester').change(function () {-->
<!--                        var semesterId = $(this).val();-->
<!--                        if (semesterId) {-->
<!--                            $.get("/admin/students/subjects/" + semesterId, function (subjects) {-->
<!--                                $('#subject').empty().append('<option value="">&#45;&#45;Select Subject&#45;&#45;</option>');-->
<!--                                $.each(subjects, function (index, subject) {-->
<!--                                    $('#subject').append('<option value="' + subject.subjectid + '">' + subject.subjectName + '</option>');-->
<!--                                });-->
<!--                            });-->
<!--                        } else {-->
<!--                            $('#subject').empty().append('<option value="">&#45;&#45;Select Subject&#45;&#45;</option>');-->
<!--                        }-->
<!--                    });-->

<!--                    // Fetch divisions when a semester is selected-->
<!--                    $('#semester').change(function () {-->
<!--                        var semesterId = $(this).val();-->
<!--                        if (semesterId) {-->
<!--                            $.get("/admin/students/divisions/" + semesterId, function (divisions) {-->
<!--                                $('#division').empty().append('<option value="">&#45;&#45;Select Division&#45;&#45;</option>');-->
<!--                                $.each(divisions, function (index, division) {-->
<!--                                    $('#division').append('<option value="' + division.id + '">' + division.name + '</option>');-->
<!--                                });-->
<!--                            });-->
<!--                        } else {-->
<!--                            $('#division').empty().append('<option value="">&#45;&#45;Select Division&#45;&#45;</option>');-->
<!--                            $('#studentTable tbody').empty();-->
<!--                        }-->
<!--                    });-->

<!--                    // Fetch students when a division is selected-->
<!--                    $('#division').change(function () {-->
<!--                        var divisionId = $(this).val();-->
<!--                        if (divisionId) {-->
<!--                            $.get("/admin/students/list/" + divisionId, function (students) {-->
<!--                                var tableBody = $('#studentTable tbody');-->
<!--                                tableBody.empty();-->
<!--                                $.each(students, function (index, student) {-->
<!--                                    tableBody.append('<tr>' +-->
<!--                                        '<td><input type="checkbox" class="student-checkbox" value="' + student.id + '"></td>' +-->
<!--                                        '<td>' + student.id + '</td>' +-->
<!--                                        '<td>' + student.firstName + '</td>' +-->
<!--                                        '<td>' + student.lastName + '</td>' +-->
<!--                                        '<td>' + student.email + '</td>' +-->
<!--                                        '</tr>');-->
<!--                                });-->
<!--                                $('#assignSubjects').prop('disabled', false);-->
<!--                            });-->
<!--                        } else {-->
<!--                            $('#studentTable tbody').empty();-->
<!--                            $('#assignSubjects').prop('disabled', true);-->
<!--                        }-->
<!--                    });-->

<!--                    // Submit selected students for subject enrollment-->
<!--                    $('#assignSubjects').click(function () {-->
<!--                        let selectedStudents = [];-->
<!--                        $('.student-checkbox:checked').each(function () {-->
<!--                            selectedStudents.push($(this).val());-->
<!--                        });-->

<!--                        if (selectedStudents.length === 0) {-->
<!--                            alert("Please select at least one student.");-->
<!--                            return;-->
<!--                        }-->

<!--                        let request = {-->
<!--                            studentIds: selectedStudents,-->
<!--                            subjectIds: [$('#subject').val()],-->
<!--                            courseId: $('#course').val(),-->
<!--                            semesterId: $('#semester').val(),-->
<!--                            enrollmentDate: new Date().toISOString().split('T')[0] // Current date-->
<!--                        };-->

<!--                        console.log(request);-->

<!--                        $.ajax({-->
<!--                            type: "POST",-->
<!--                            url: "/subject-enrollment/enroll",-->
<!--                            contentType: "application/json",-->
<!--                            data: JSON.stringify(request),-->
<!--                            success: function (response) {-->
<!--                                alert("Enrollment successful!");-->
<!--                            },-->
<!--                            error: function (error) {-->
<!--                                alert("Error: " + error.responseText);-->
<!--                            }-->
<!--                        });-->
<!--                    });-->

<!--                });-->
<!--            </script>-->

<!--        </main>-->
<!--    </div>-->
<!--</div>-->

<!--</body>-->
<!--</html>-->


<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="'Student Subject Enrollment'">Student Subject Enrollment</title>
    <!--    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">-->
</head>
<body>

<div th:replace="layout/base.html">
    <div th:fragment="content">


        <div class="col-lg-10">
            <div class="card shadow mb-4">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Student Subject Enrollment</h4>
                </div>
                <div class="card-body">
                    <form id="enrollmentForm">
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="department">Select Department</label>
                                <select class="form-control" id="department" required>
                                    <option value="">--Select Department--</option>
                                    <th:block th:each="department : ${departments}">
                                        <option th:value="${department.id}" th:text="${department.name}"></option>
                                    </th:block>
                                </select>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="course">Select Course</label>
                                <select class="form-control" id="course" required>
                                    <option value="">--Select Course--</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-4">
                                <label for="semester">Select Semester</label>
                                <select class="form-control" id="semester" required>
                                    <option value="">--Select Semester--</option>
                                </select>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="subject">Select Subject</label>
                                <select class="form-control" id="subject" required>
                                    <option value="">--Select Subject--</option>
                                </select>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="division">Select Division</label>
                                <select class="form-control" id="division" required>
                                    <option value="">--Select Division--</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card shadow mb-4">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">Select Students</h5>
                </div>
                <div class="card-body">
                    <table class="table table-bordered">
                        <thead class="thead-dark">
                        <tr>
                            <th><input type="checkbox" id="selectAll"></th>
                            <th>ID</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Email</th>
                        </tr>
                        </thead>
                        <tbody id="studentTable"></tbody>
                    </table>
                    <button id="assignSubjects" class="btn btn-primary mt-2" disabled>Assign Subject to Selected
                        Students
                    </button>
                </div>
            </div>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script>
            $(document).ready(function () {
                $('#department').change(function () {
                    var departmentId = $(this).val();
                    if (departmentId) {
                        $.get("/admin/students/courses/" + departmentId, function (courses) {
                            $('#course').empty().append('<option value="">--Select Course--</option>');
                            $.each(courses, function (index, course) {
                                $('#course').append('<option value="' + course.courseID + '">' + course.courseName + '</option>');
                            });
                        });
                    }
                });

                $('#course').change(function () {
                    var courseId = $(this).val();
                    if (courseId) {
                        $.get("/admin/students/semesters/" + courseId, function (semesters) {
                            $('#semester').empty().append('<option value="">--Select Semester--</option>');
                            $.each(semesters, function (index, semester) {
                                $('#semester').append('<option value="' + semester.id + '">' + semester.name + " - " + semester.academicYear + '</option>');
                            });
                        });
                    }
                });

                $('#semester').change(function () {
                    var semesterId = $(this).val();
                    if (semesterId) {
                        $.get("/admin/students/subjects/" + semesterId, function (subjects) {
                            $('#subject').empty().append('<option value="">--Select Subject--</option>');
                            $.each(subjects, function (index, subject) {
                                $('#subject').append('<option value="' + subject.subjectid + '">' + subject.subjectName + '</option>');
                            });
                        });
                        $.get("/admin/students/divisions/" + semesterId, function (divisions) {
                            $('#division').empty().append('<option value="">--Select Division--</option>');
                            $.each(divisions, function (index, division) {
                                $('#division').append('<option value="' + division.id + '">' + division.name + '</option>');
                            });
                        });
                    }
                });

                $('#division').change(function () {
                    var divisionId = $(this).val();
                    if (divisionId) {
                        $.get("/admin/students/list/" + divisionId, function (students) {
                            var tableBody = $('#studentTable');
                            tableBody.empty();
                            $.each(students, function (index, student) {
                                tableBody.append('<tr>' +
                                    '<td><input type="checkbox" class="student-checkbox" value="' + student.id + '"></td>' +
                                    '<td>' + student.id + '</td>' +
                                    '<td>' + student.firstName + '</td>' +
                                    '<td>' + student.lastName + '</td>' +
                                    '<td>' + student.email + '</td>' +
                                    '</tr>');
                            });
                            $('#assignSubjects').prop('disabled', false);
                        });
                    }
                });

                // Submit selected students for subject enrollment
                $('#assignSubjects').click(function () {
                    let selectedStudents = [];
                    $('.student-checkbox:checked').each(function () {
                        selectedStudents.push($(this).val());
                    });

                    if (selectedStudents.length === 0) {
                        alert("Please select at least one student.");
                        return;
                    }

                    let request = {
                        studentIds: selectedStudents,
                        subjectIds: [$('#subject').val()],
                        courseId: $('#course').val(),
                        semesterId: $('#semester').val(),
                        enrollmentDate: new Date().toISOString().split('T')[0] // Current date
                    };

                    console.log(request);

                    $.ajax({
                        type: "POST",
                        url: "/subject-enrollment/enroll",
                        contentType: "application/json",
                        data: JSON.stringify(request),
                        success: function (response) {
                            alert("Enrollment successful!");
                        },
                        error: function (error) {
                            alert("Error: " + error.responseText);
                        }
                    });
                });

            });

            $(document).on('change', '#selectAll', function () {
                $('.student-checkbox').prop('checked', this.checked);
            });
        </script>
    </div>
</div>

</body>
</html>
