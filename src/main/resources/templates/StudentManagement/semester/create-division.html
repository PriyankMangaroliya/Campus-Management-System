<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Create Divisions</title>
<!--    <link rel="stylesheet" type="text/css" href="/css/styles.css">-->
</head>
<body>

<!-- Corrected content replacement -->
<div th:replace="layout/base.html">
    <div th:fragment="content">
        <div class="col-md-12">
            <div class="card shadow mb-4">
                <div class="card-header">
                    <strong class="card-title">Create Divisions</strong>
                </div>
                <div class="card-body">
                    <form class="needs-validation" action="/create-divisions" method="post" novalidate>

                        <div class="form-row">
                            <div class="col-md-8 mb-3">
                                <label for="semesterId">Semester ID:</label>
                                <input type="number" name="semesterId" id="semesterId" th:value="${semesterId}"
                                       class="form-control" required>
                                <div class="invalid-feedback">Please provide a valid semester ID.</div>
                            </div>
                        </div>

                        <h3>Existing Divisions:</h3>
                        <div id="divisionContainer">
                            <!-- Display existing divisions -->
                            <th:block th:if="${divisions != null and not #lists.isEmpty(divisions)}">
                                <div th:each="division : ${divisions}" class="division-entry mb-3">
                                    <div class="form-row">
                                        <div class="col-md-8 mb-3">
                                            <input type="text" name="divisionNames" th:value="${division.name}"
                                                   class="form-control" readonly>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <select name="facultyIds" class="form-control">
                                                <option th:each="faculty : ${departmentFaculties}"
                                                        th:value="${faculty.facultyId}"
                                                        th:text="${faculty.firstName + ' ' + faculty.lastName}"
                                                        th:selected="${division.faculty != null and division.faculty.facultyId == faculty.facultyId}">
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </th:block>
                        </div>

                        <button type="button" class="btn btn-secondary mt-3" onclick="addDivisionField()">Add More
                            Divisions
                        </button>
                        <button type="submit" class="btn btn-primary mt-3">Create Divisions</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Convert faculty list to JSON in JavaScript -->
        <script th:inline="javascript">
            let departmentFaculties = /*[[${departmentFaculties}]]*/ [];
            console.log("Faculty Data:", departmentFaculties);
        </script>

        <script>
            function addDivisionField() {
                console.log("Adding new division field...");
                let container = document.getElementById("divisionContainer");
                let div = document.createElement("div");
                div.classList.add("division-entry", "mb-3");

                // Create division name input
                let divisionNameInput = document.createElement("input");
                divisionNameInput.type = "text";
                divisionNameInput.name = "divisionNames";
                divisionNameInput.classList.add("form-control");
                divisionNameInput.required = true;
                divisionNameInput.placeholder = "Enter Division Name";

                // Create faculty dropdown
                let facultySelect = document.createElement("select");
                facultySelect.name = "facultyIds";
                facultySelect.classList.add("form-control");

                let defaultOption = document.createElement("option");
                defaultOption.value = "";
                defaultOption.textContent = "Select Faculty";
                facultySelect.appendChild(defaultOption);

                // Populate the dropdown with faculties
                departmentFaculties.forEach(faculty => {
                    let option = document.createElement("option");
                    option.value = faculty.facultyId;
                    option.textContent = faculty.firstName + " " + faculty.lastName;
                    facultySelect.appendChild(option);
                });

                // Create remove button
                let removeButton = document.createElement("button");
                removeButton.type = "button";
                removeButton.textContent = "Remove";
                removeButton.classList.add("btn", "btn-danger", "mt-2");
                removeButton.onclick = function () {
                    removeDivisionField(this);
                };

                // Append all elements to the new division div
                div.appendChild(divisionNameInput);
                div.appendChild(facultySelect);
                div.appendChild(removeButton);

                // Append the new division div to the container
                container.appendChild(div);
            }

            function removeDivisionField(button) {
                console.log("Removing division field...");
                button.parentElement.remove();
            }
        </script>

    </div>
</div>

</body>
</html>
